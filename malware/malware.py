#!/usr/bin/python3
# -*- coding: utf-8 -*-

import re
import requests

sources = (
    'https://feodotracker.abuse.ch/downloads/ipblocklist.txt',
    'https://malc0de.com/bl/IP_Blacklist.txt',
    'https://www.malwaredomainlist.com/hostslist/ip.txt',
)
destination = '/var/www/html/malware.rsc'

ips = [
    '192.168.x.y',      # Custom
]

ip_re = re.compile(r'(?<![0-9])(?:(?:[0-1]?[0-9]{1,2}|2[0-4][0-9]|25[0-5])[.](?:[0-1]?[0-9]{1,2}|2[0-4][0-9]|25[0-5])[.](?:[0-1]?[0-9]{1,2}|2[0-4][0-9]|25[0-5])[.](?:[0-1]?[0-9]{1,2}|2[0-4][0-9]|25[0-5]))(?![0-9])')

for source in sources:
    try:
        r = requests.get(source)
        for line in r.text.splitlines():
            m = ip_re.match(line)
            if m:
                ips.append(m.group(0))
    except:
        pass

with open(destination, 'w') as f:
    f.write('/ip firewall address-list\n')
    f.write('remove [find list=Malware]\n')
    for ip in sorted(set(ips)):
        f.write('add list=Malware address={}\n'.format(ip))

