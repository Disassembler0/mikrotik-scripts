#!/bin/bash

RSCFILE=/var/www/html/malware.rsc
TMPDIR=$(mktemp -d)

wget -q https://ransomwaretracker.abuse.ch/downloads/RW_IPBL.txt -O ${TMPDIR}/rwt.txt
wget -q https://zeustracker.abuse.ch/blocklist.php?download=badips -O ${TMPDIR}/zeus.txt
wget -q https://malc0de.com/bl/IP_Blacklist.txt -O ${TMPDIR}/malcode.txt
wget -q https://www.malwaredomainlist.com/hostslist/ip.txt -O ${TMPDIR}/mdl.txt

cat <<EOF >${TMPDIR}/custom.txt
192.168.1.1
EOF

cat <<EOF >${TMPDIR}/whitelist.txt
192.168.1.1
EOF

echo -e "/ip firewall address-list\nremove [find list=Malware]" >${RSCFILE}
cat ${TMPDIR}/*.txt | grep '^[[:digit:]]' | grep -v -f ${TMPDIR}/whitelist.txt | sort -u | sed 's/^/add list=Malware address=/' >>${RSCFILE}
rm -rf ${TMPDIR}

# Remove '^M' from malware.rsc
perl -i -pe 's/\r\n$/\n/g' malware.rsc
